<app-navbar></app-navbar>

<div class="steps-container">
  <!-- Botón para subir archivo -->
  <input
    type="file"
    id="fileInput"
    (change)="onFileSelected($event)"
    style="display: none"
  />

  <div class="upload-section">
    <button
      mat-raised-button
      color="primary"
      class="square-button"
      (click)="triggerFileInput()"
      matTooltip="Seleccionar archivo para subir"
    >
      <mat-icon>upload</mat-icon>
      Subir Archivo
    </button>
    <div *ngIf="selectedFile" class="file-info">
      Archivo seleccionado: {{ selectedFile.name }}
    </div>
  </div>

  <!-- Botón procesar, deshabilitado hasta que se suba un archivo -->
  <button mat-raised-button color="primary" class="square-button" (click)="ejecutarMinizinc()">
    Procesar
  </button>
</div>


<mat-tab-group class="tab-group">
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">upload</mat-icon>
      Datos Cargados
    </ng-template>

    <div *ngIf="parsedData.numPersonas" class="data-display">
      <h3>Datos Cargados</h3>
      <p><strong>Número de Personas:</strong> {{ parsedData.numPersonas }}</p>
      <p><strong>Número de Opiniones:</strong> {{ parsedData.numOpiniones }}</p>

      <div>
        <strong>Distribución de Personas por Opinión:</strong>
        <ul>
          <li
            *ngFor="
              let opinion of parsedData.distribucionOpiniones;
              let i = index
            "
          >
            Opinión {{ i + 1 }}: {{ opinion }}
          </li>
        </ul>
      </div>

      <div>
        <strong>Valores de Opiniones:</strong>
        <ul>
          <li *ngFor="let valor of parsedData.valoresOpiniones; let i = index">
            Opinión {{ i + 1 }}: {{ valor }}
          </li>
        </ul>
      </div>

      <div>
        <strong>Costos Extras de Opiniones:</strong>
        <ul>
          <li *ngFor="let costoExtra of parsedData.costosExtras; let i = index">
            Opinión {{ i + 1 }}: {{ costoExtra }}
          </li>
        </ul>
      </div>

      <div>
        <strong>Costos de Desplazamiento entre Opiniones:</strong>
        <table>
          <tr>
            <th
              *ngFor="
                let i of parsedData.costosDesplazamiento[0];
                let j = index
              "
            >
              Opinión {{ j + 1 }}
            </th>
          </tr>
          <tr *ngFor="let row of parsedData.costosDesplazamiento">
            <td *ngFor="let cost of row">{{ cost }}</td>
          </tr>
        </table>
      </div>

      <p>
        <strong>Costo Total Máximo Permitido:</strong>
        {{ parsedData.costoTotalMax }}
      </p>
      <p>
        <strong>Número Máximo de Movimientos Permitidos:</strong>
        {{ parsedData.maxMovimientos }}
      </p>
    </div>
  </mat-tab>

  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">check_circle</mat-icon>
      Resultado
    </ng-template>
  
    <div *ngIf="polarizacion_inicial !== null && movimientos_totales !== null && distribucion_final !== null">
      <h3>Resultado de MiniZinc</h3>
      <p><strong>Polarización inicial:</strong> {{ polarizacion_inicial }}</p>
      <p><strong>Polarización final:</strong> {{ polarizacion_final }}</p>
      <p><strong>Movimientos totales:</strong> {{ movimientos_totales }}</p>
      <p><strong>Costo total:</strong> {{ costo_total }}</p>
  
      <h4>Distribución final de personas por opinión</h4>
      <table>
        <thead>
          <tr>
            <th>Opinión</th>
            <th>Personas</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let valor of distribucion_final; let i = index">
            <td>Opinión {{ i + 1 }}</td>
            <td>{{ valor }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <div *ngIf="errorMessage">
      <p class="error-message">{{ errorMessage }}</p>
    </div>
  </mat-tab>
  
</mat-tab-group>
<router-outlet></router-outlet>
